<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ø¨ÙŠØ§Ù†Ø§Øª Ø·Ù„Ø§Ø¨ Ù…Ø±ÙƒØ² Ø§Ù„ØªØ­ÙÙŠØ¸</title>

    <!-- Ø®Ø· Ø¹Ø±Ø¨ÙŠ -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #0f766e;
            --primary-dark: #115e59;
            --accent: #f59e0b;
            --bg: #020617;
            --card-bg: #0b1120;
            --card-border: #1e293b;
            --text-main: #e5e7eb;
            --text-muted: #9ca3af;
            --danger: #dc2626;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: "Cairo", system-ui, sans-serif;
            background: radial-gradient(circle at top, #1e293b 0, #020617 50%, #000 100%);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            align-items: stretch;
            justify-content: center;
        }

        #app {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px 12px 32px;
        }

        /* ---------- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ---------- */

        .splash {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .splash::before {
            content: "";
            position: absolute;
            inset: -20%;
            background:
                    radial-gradient(circle at top, rgba(56,189,248,0.10), transparent 60%),
                    radial-gradient(circle at bottom, rgba(52,211,153,0.10), transparent 60%);
            opacity: 0.8;
            filter: blur(4px);
            animation: bgPulse 10s infinite alternate;
        }

        @keyframes bgPulse {
            0%   { transform: scale(1);   opacity: 0.9; }
            50%  { transform: scale(1.04); opacity: 1; }
            100% { transform: scale(1.08); opacity: 0.8; }
        }

        .splash-content {
            position: relative;
            z-index: 2;
            text-align: center;
            max-width: 540px;
            padding: 32px 24px;
            background: linear-gradient(to bottom right,
            rgba(15,23,42,0.95),
            rgba(15,23,42,0.85));
            border-radius: 24px;
            border: 1px solid rgba(148,163,184,0.35);
            box-shadow: 0 20px 45px rgba(15,23,42,0.9);
            animation: slideUp 1.2s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(40px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .logo-wrapper {
            position: relative;
            margin-bottom: 24px;
            display: inline-block;
        }

        .logo-ring {
            position: absolute;
            inset: -12px;
            border-radius: 999px;
            border: 2px dashed rgba(94,234,212,0.8);
            animation: spin 12s linear infinite;
            opacity: 0.6;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to   { transform: rotate(-360deg); }
        }

        .logo-wrapper img {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid rgba(248,250,252,0.8);
            box-shadow: 0 10px 25px rgba(15,23,42,0.9);
        }

        .splash-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 999px;
            background: rgba(15,118,110,0.25);
            border: 1px solid rgba(34,197,94,0.5);
            color: #bbf7d0;
            font-size: 12px;
            margin-bottom: 16px;
        }

        .splash-title {
            font-size: 24px;
            font-weight: 700;
            margin: 8px 0 4px;
        }

        .splash-subtitle {
            font-size: 15px;
            color: var(--text-muted);
            margin-bottom: 22px;
        }

        .start-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 32px;
            border-radius: 999px;
            border: none;
            background: linear-gradient(135deg, #22c55e, #10b981);
            color: #ecfeff;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 12px 30px rgba(16,185,129,0.65);
            transition: transform 0.14s ease, box-shadow 0.14s ease, filter 0.14s ease;
        }

        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 18px 40px rgba(34,197,94,0.7);
            filter: brightness(1.05);
        }

        .start-btn:active {
            transform: translateY(1px) scale(0.99);
            box-shadow: 0 10px 24px rgba(16,185,129,0.6);
        }

        .start-btn-icon {
            font-size: 18px;
        }

        /* ---------- Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ---------- */

        .hidden {
            display: none !important;
        }

        .main-layout {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */

        .app-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            padding: 14px 18px;
            background: linear-gradient(to left,
            rgba(15,23,42,0.95),
            rgba(15,23,42,0.9));
            border-radius: 18px;
            border: 1px solid var(--card-border);
            box-shadow: 0 8px 22px rgba(15,23,42,0.8);
        }

        .app-header-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .app-logo-mini {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid rgba(248,250,252,0.7);
        }

        .app-header-text strong {
            display: block;
            font-size: 16px;
        }

        .app-header-text span {
            font-size: 12px;
            color: var(--text-muted);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .outline-btn {
            padding: 6px 10px;
            font-size: 12px;
            border-radius: 999px;
            border: 1px solid rgba(148,163,184,0.6);
            background: transparent;
            color: var(--text-main);
            cursor: pointer;
        }

        .outline-btn:hover {
            border-color: rgba(248,250,252,0.9);
        }

        /* Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… */

        .menu-card {
            background: rgba(15,23,42,0.96);
            border-radius: 18px;
            padding: 14px 16px;
            border: 1px solid var(--card-border);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .menu-section {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            justify-content: space-between;
        }

        .menu-title {
            font-size: 14px;
            color: var(--text-muted);
        }

        .menu-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .menu-btn {
            border: none;
            cursor: pointer;
            padding: 8px 16px;
            border-radius: 999px;
            background: rgba(15,118,110,0.18);
            color: #a5f3fc;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            border: 1px solid transparent;
            transition: background 0.15s ease, transform 0.15s ease, border-color 0.15s ease;
        }

        .menu-btn .icon {
            font-size: 16px;
        }

        .menu-btn:hover {
            background: rgba(13,148,136,0.40);
            transform: translateY(-1px);
            border-color: rgba(45,212,191,0.6);
        }

        .menu-btn.active {
            background: linear-gradient(135deg, #0f766e, #14b8a6);
            color: #ecfeff;
            border-color: rgba(34,211,238,0.8);
        }

        /* Ù‚Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„ */

        .table-section {
            background: rgba(15,23,42,0.96);
            border-radius: 18px;
            border: 1px solid var(--card-border);
            padding: 16px 16px 18px;
            box-shadow: 0 16px 40px rgba(15,23,42,0.85);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .table-header {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .table-header-title h2 {
            font-size: 18px;
            margin: 0;
        }

        .table-header-title span {
            font-size: 12px;
            color: var(--text-muted);
        }

        .table-header-actions {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        .primary-small,
        .ghost-small {
            padding: 6px 12px;
            border-radius: 999px;
            font-size: 12px;
            cursor: pointer;
        }

        .primary-small {
            border: none;
            background: #0ea5e9;
            color: #ecfeff;
        }

        .primary-small:hover {
            filter: brightness(1.05);
        }

        .ghost-small {
            border: 1px solid rgba(148,163,184,0.6);
            background: transparent;
            color: var(--text-main);
        }

        .status-pill {
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 999px;
            border: 1px solid rgba(148,163,184,0.6);
            color: var(--text-muted);
        }

        .status-pill.ok {
            border-color: rgba(74,222,128,0.7);
            color: #bbf7d0;
            background: rgba(22,163,74,0.15);
        }

        /* Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù†ÙØ³Ù‡ */

        .table-container {
            position: relative;
            border-radius: 14px;
            border: 1px solid rgba(30,64,175,0.6);
            overflow: hidden;
        }

        .table-scroll {
            max-height: calc(100vh - 260px);
            overflow: auto;
            scrollbar-width: thin;
            scrollbar-color: #334155 transparent;
        }

        .table-scroll::-webkit-scrollbar {
            height: 8px;
            width: 8px;
        }
        .table-scroll::-webkit-scrollbar-track {
            background: transparent;
        }
        .table-scroll::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 999px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 760px;
        }

        thead {
            background: linear-gradient(to left, #1e293b, #0f172a);
            position: sticky;
            top: 0;
            z-index: 5;
        }

        thead th {
            padding: 8px 6px;
            font-size: 13px;
            text-align: center;
            border-bottom: 1px solid rgba(51,65,85,0.9);
            white-space: nowrap;
        }

        tbody tr:nth-child(even) {
            background: rgba(15,23,42,0.95);
        }

        tbody tr:nth-child(odd) {
            background: rgba(15,23,42,0.90);
        }

        tbody td {
            padding: 6px 6px;
            font-size: 13px;
            border-bottom: 1px solid rgba(31,41,55,0.8);
            text-align: center;
            white-space: nowrap;
        }

        tbody tr:hover {
            background: rgba(30,64,175,0.35);
        }

        .loading-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom,
            rgba(15,23,42,0.96),
            rgba(15,23,42,0.96));
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 8px;
            z-index: 10;
        }

        .spinner {
            width: 32px;
            height: 32px;
            border-radius: 999px;
            border: 3px solid rgba(148,163,184,0.4);
            border-top-color: #38bdf8;
            animation: spin 0.9s linear infinite;
        }

        .error-msg {
            color: var(--danger);
            font-size: 13px;
        }

        .muted-text {
            color: var(--text-muted);
            font-size: 12px;
        }

        /* ---------- Responsiveness ---------- */

        @media (max-width: 1024px) {
            #app {
                padding: 16px 8px 24px;
            }

            .table-scroll {
                max-height: calc(100vh - 240px);
            }
        }

        @media (max-width: 768px) {
            .splash-content {
                margin: 0 12px;
                padding: 24px 18px;
            }

            .splash-title {
                font-size: 22px;
            }

            .splash-subtitle {
                font-size: 14px;
            }

            .app-header {
                flex-direction: column;
                align-items: flex-start;
                padding: 10px 12px;
            }

            .menu-card {
                padding: 10px 12px;
            }

            .table-section {
                padding: 12px;
            }

            .table-scroll {
                max-height: calc(100vh - 260px);
            }
        }

        @media (max-width: 480px) {
            .splash-title {
                font-size: 20px;
            }
            .splash-subtitle {
                font-size: 13px;
            }

            .menu-buttons {
                width: 100%;
            }

            .menu-btn {
                flex: 1 1 100%;
                justify-content: center;
            }

            table {
                min-width: 640px;
            }
        }
    </style>
</head>

<body>
<div id="app">

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (Ø§Ù„Ø´Ø¹Ø§Ø± + Ø§Ø¨Ø¯Ø£) -->
    <section id="splash" class="splash">
        <div class="splash-content">
            <div class="splash-badge">
                <span>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</span>
            </div>

            <div class="logo-wrapper">
                <div class="logo-ring"></div>
                <!-- Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø±ÙƒØ² Ù…Ù† Google Drive -->
                <img id="centerLogoBig"
                     src="logo.png"
                     alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø±ÙƒØ²">
            </div>

            <h1 class="splash-title">Ù…Ø±ÙƒØ² ØªØ­ÙÙŠØ¸ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</h1>
            <p class="splash-subtitle">
                ÙˆØ§Ø¬Ù‡Ø© ØªÙØ§Ø¹Ù„ÙŠØ© Ù„Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© Ø¨Ø´ÙƒÙ„ Ù…Ù†Ø¸Ù… ÙˆØ§Ø­ØªØ±Ø§ÙÙŠ.
            </p>

            <button id="startBtn" class="start-btn">
                <span class="start-btn-icon">â–¶</span>
                <span>Ø§Ø¨Ø¯Ø£</span>
            </button>
        </div>
    </section>

    <!-- Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <section id="main" class="hidden">
        <div class="main-layout">

            <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
            <header class="app-header">
                <div class="app-header-info">
                    <!-- Ù†ÙØ³ Ø§Ù„Ø´Ø¹Ø§Ø± Ù„ÙƒÙ† Ù…ØµØºÙ‘Ø± -->
                <img id="centerLogoMini"
                     class="app-logo-mini"
                     src="logo.png"
                     alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø±ÙƒØ²">
                    <div class="app-header-text">
                        <strong>Ù„ÙˆØ­Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</strong>
                        <span>Ø¹Ø±Ø¶ Ù…Ø¨Ø§Ø´Ø± Ù…Ù† Google Sheets Ù„ÙƒÙ„ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</span>
                    </div>
                </div>

                <div class="header-actions">
                    <button class="outline-btn" id="backToSplashBtn">
                        Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠØ©
                    </button>
                </div>
            </header>

            <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ (Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨) -->
            <div class="menu-card">
                <div class="menu-section">
                    <div class="menu-title">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
                    <div class="menu-buttons">
                        <button class="menu-btn active" id="studentsMainBtn">
                            <span class="icon">ğŸ‘¨â€ğŸ“</span>
                            <span>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ø­Ù„ -->
            <div class="menu-card">
                <div class="menu-title">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© Ù„Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡Ø§</div>
                <div class="menu-buttons">
                    <button class="menu-btn level-btn" data-level="primary">
                        <span class="icon">ğŸ“˜</span>
                        <span>Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©</span>
                    </button>
                    <button class="menu-btn level-btn" data-level="prep">
                        <span class="icon">ğŸ“—</span>
                        <span>Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠØ©</span>
                    </button>
                    <button class="menu-btn level-btn" data-level="secondary">
                        <span class="icon">ğŸ“•</span>
                        <span>Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ©</span>
                    </button>
                    <button class="menu-btn level-btn" data-level="university">
                        <span class="icon">ğŸ“™</span>
                        <span>Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ©</span>
                    </button>
                </div>
            </div>

            <!-- Ù‚Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
            <div class="table-section" id="tableSection">
                <div class="table-header">
                    <div class="table-header-title">
                        <h2 id="tableTitle">Ø§Ø®ØªØ± Ù…Ø±Ø­Ù„Ø© Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
                        <span id="tableSubtitle">
                            Ù„Ø§ ÙŠØªÙ… Ø­ÙØ¸ Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©ØŒ ÙÙ‚Ø· Ù‚Ø±Ø§Ø¡Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Google Sheets.
                        </span>
                    </div>

                    <div class="table-header-actions">
                        <span id="statusPill" class="status-pill">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ­Ù…ÙŠÙ„ Ø­Ø§Ù„ÙŠØ§Ù‹</span>
                        <button id="reloadBtn" class="ghost-small">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-scroll">
                        <table id="studentsTable">
                            <thead>
                            <tr id="tableHeaderRow">
                                <!-- ÙŠÙÙ…Ù„Ø£ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ -->
                            </tr>
                            </thead>
                            <tbody id="tableBody">
                            <tr>
                                <td colspan="10" class="muted-text">
                                    Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ø±Ø­Ù„Ø© Ø¨Ø¹Ø¯.
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Ø·Ø¨Ù‚Ø© ØªØ­Ù…ÙŠÙ„ -->
                    <div id="loadingOverlay" class="loading-overlay hidden">
                        <div class="spinner"></div>
                        <div class="muted-text">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets...</div>
                    </div>
                </div>
            </div>

        </div>
    </section>
</div>

<script>
    /******************************
     *  Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
     ******************************/

    // ID Ù…Ù„Ù Google Sheets
    const SPREADSHEET_ID = "14bW4VEbCGTOq55aYXiti6xZUPRkwMax7iC7NiynOjb4";

    // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù€ gid Ù„ÙƒÙ„ ØªØ¨ÙˆÙŠØ¨
    const SHEETS_CONFIG = {
        primary: {      // Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©
            gid: "926618487",
            title: "Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"
        },
        prep: {         // Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠØ©
            gid: "CHANGE_ME_PREP_GID",
            title: "Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠØ©"
        },
        secondary: {    // Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ©
            gid: "CHANGE_ME_SECONDARY_GID",
            title: "Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ©"
        },
        university: {   // Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ©
            gid: "CHANGE_ME_UNIVERSITY_GID",
            title: "Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ©"
        }
    };

    // Ù„Ùˆ Ø­Ø§Ø¨Ø¨ ØªØªØ¬Ø§Ù‡Ù„ Ø£ÙˆÙ„ N Ø£Ø¹Ù…Ø¯Ø© Ù…Ù† ÙƒÙ„ ØµÙ
    const IGNORE_FIRST_N_COLUMNS = 0;

    /******************************
     *        Ø¹Ù†Ø§ØµØ± DOM
     ******************************/

    const splashEl = document.getElementById("splash");
    const mainEl = document.getElementById("main");
    const startBtn = document.getElementById("startBtn");
    const backToSplashBtn = document.getElementById("backToSplashBtn");
    const levelButtons = document.querySelectorAll(".level-btn");
    const tableTitleEl = document.getElementById("tableTitle");
    const tableSubtitleEl = document.getElementById("tableSubtitle");
    const tableHeaderRowEl = document.getElementById("tableHeaderRow");
    const tableBodyEl = document.getElementById("tableBody");
    const loadingOverlayEl = document.getElementById("loadingOverlay");
    const reloadBtn = document.getElementById("reloadBtn");
    const statusPillEl = document.getElementById("statusPill");

    let currentLevelKey = null;

    /******************************
     *       ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø©
     ******************************/

    function showSplash() {
        splashEl.classList.remove("hidden");
        mainEl.classList.add("hidden");
    }

    function showMain() {
        splashEl.classList.add("hidden");
        mainEl.classList.remove("hidden");
    }

    function setLoadingState(isLoading, text) {
        if (isLoading) {
            loadingOverlayEl.classList.remove("hidden");
            statusPillEl.classList.add("ok");
            statusPillEl.textContent = text || "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";
        } else {
            loadingOverlayEl.classList.add("hidden");
            statusPillEl.classList.remove("ok");
            statusPillEl.textContent = text || "Ø¬Ø§Ù‡Ø²";
        }
    }

    function setErrorState(message) {
        loadingOverlayEl.classList.add("hidden");
        statusPillEl.classList.remove("ok");
        statusPillEl.textContent = "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„";

        tableHeaderRowEl.innerHTML = "";
        tableBodyEl.innerHTML =
            `<tr><td colspan="10" class="error-msg">${message}</td></tr>`;
    }

    function buildCsvUrl(gid) {
        return `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/export?format=csv&gid=${gid}`;
    }

    // Parser Ø¨Ø³ÙŠØ· Ù„Ù„Ù€ CSV
    function parseCsv(csvText) {
        const rows = [];
        const lines = csvText.split(/\r?\n/).filter(l => l.trim().length > 0);

        for (const line of lines) {
            const cells = line.split(",").map(c => c.trim());
            rows.push(cells);
        }
        return rows;
    }

    function renderTable(rows) {
        if (!rows || rows.length === 0) {
            tableHeaderRowEl.innerHTML = "";
            tableBodyEl.innerHTML =
                `<tr><td colspan="10" class="muted-text">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶.</td></tr>`;
            return;
        }

        const headerRow = rows[0].slice(IGNORE_FIRST_N_COLUMNS);

        // Ø§Ù„Ù‡ÙŠØ¯Ø±
        tableHeaderRowEl.innerHTML = "";
        headerRow.forEach((header, index) => {
            const th = document.createElement("th");
            th.textContent = header || `Ø¹Ù…ÙˆØ¯ ${index + 1}`;
            tableHeaderRowEl.appendChild(th);
        });

        // Ø§Ù„Ø¬Ø³Ù…
        tableBodyEl.innerHTML = "";
        const dataRows = rows.slice(1);

        if (dataRows.length === 0) {
            tableBodyEl.innerHTML =
                `<tr><td colspan="${headerRow.length}" class="muted-text">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø¨Ø¹Ø¯.</td></tr>`;
            return;
        }

        dataRows.forEach(row => {
            const rowEl = document.createElement("tr");
            const cells = row.slice(IGNORE_FIRST_N_COLUMNS);

            cells.forEach(cell => {
                const td = document.createElement("td");
                td.textContent = cell;
                rowEl.appendChild(td);
            });

            tableBodyEl.appendChild(rowEl);
        });

        tableSubtitleEl.textContent = `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: ${dataRows.length}`;
    }

    async function loadLevel(levelKey) {
        const config = SHEETS_CONFIG[levelKey];
        if (!config || !config.gid || !SPREADSHEET_ID) {
            setErrorState("ØªØ£ÙƒØ¯ Ù…Ù† Ø¶Ø¨Ø· SPREADSHEET_ID Ùˆ gid Ù„ÙƒÙ„ Ù…Ø±Ø­Ù„Ø© ÙÙŠ Ø§Ù„ÙƒÙˆØ¯.");
            return;
        }

        // Ù„Ùˆ Ù„Ø³Ù‡ Ù…Ø§ ØºÙŠØ±ØªØ´ Ù‚ÙŠÙ… CHANGE_ME Ø®Ù„ÙŠÙ‡Ø§ Ù…Ø§ ØªØ´ØªØºÙ„Ø´ Ø¨Ø¯Ù„ Ù…Ø§ ØªØ¹Ø·ÙŠ Ø®Ø·Ø£ ØºØ±ÙŠØ¨
        if (config.gid.startsWith("CHANGE_ME")) {
            setErrorState("Ù„Ù… ÙŠØªÙ… Ø¶Ø¨Ø· gid Ø§Ù„Ø®Ø§Øµ Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø±Ø­Ù„Ø© ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø¹Ø¯.");
            return;
        }

        currentLevelKey = levelKey;

        tableTitleEl.textContent = `Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ - ${config.title}`;
        tableSubtitleEl.textContent = "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø´ÙŠØª...";

        // ØªÙØ¹ÙŠÙ„/Ø¥Ù„ØºØ§Ø¡ ØªÙØ¹ÙŠÙ„ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø­Ù„
        levelButtons.forEach(btn => {
            if (btn.dataset.level === levelKey) {
                btn.classList.add("active");
            } else {
                btn.classList.remove("active");
            }
        });

        setLoadingState(true, "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª " + config.title + "...");

        try {
            const url = buildCsvUrl(config.gid);
            const response = await fetch(url);

            if (!response.ok) {
                throw new Error(
                    "ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Google SheetsØŒ ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ø´ÙŠØª Ù…Ù†Ø´ÙˆØ± Ù„Ù„Ø¹Ø§Ù…Ø© (Publish to web)."
                );
            }

            const csvText = await response.text();
            const rows = parseCsv(csvText);

            renderTable(rows);
            setLoadingState(false, "ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­");

        } catch (err) {
            console.error(err);
            setErrorState("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: " + err.message);
        }
    }

    /******************************
     *       Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
     ******************************/

    startBtn.addEventListener("click", () => {
        showMain();
    });

    backToSplashBtn.addEventListener("click", () => {
        showSplash();
    });

    levelButtons.forEach(btn => {
        btn.addEventListener("click", () => {
            const levelKey = btn.dataset.level;
            loadLevel(levelKey);
        });
    });

    reloadBtn.addEventListener("click", () => {
        if (currentLevelKey) {
            loadLevel(currentLevelKey);
        } else {
            tableSubtitleEl.textContent = "Ø§Ø®ØªØ± Ù…Ø±Ø­Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… Ø§Ø¶ØºØ· ØªØ­Ø¯ÙŠØ«.";
        }
    });

    // Ù„Ø§ ØªØ­Ù…ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ø£ÙŠ Ù…Ø±Ø­Ù„Ø© Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
</script>
</body>
</html>
